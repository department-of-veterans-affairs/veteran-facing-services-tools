# VA.gov workflow

VA.gov uses a [Continuous Integration](https://www.thoughtworks.com/continuous-integration) process, which consists of the following steps:

1. Determine which issue to work on
1. Create feature branch
1. Code new functionality
1. Write tests for new functionality
1. Submit pull request
1. Run unit tests and compliance scans (kicked off when a pull request is created)
1. Test and peer review code (read: code review)
1. Merge code to stable code base

When the last step is performed, the developer begins this process anew with another feature.

The workflow that we use closely resembles [GitHub Flow](https://guides.github.com/introduction/flow/).

## Choose an issue to work on

The VA handbook has more information about the broader process for delivering services to Veterans on VA.gov. Developers work in an agile framework, where issues are assigned to sprints and developers work on this items over the two-week sprint period. You'll need to work with your team to determine the right issue for you to work on.

## Create feature branch

Each project's code base has a branch called `master` by default. Anything in `master` is deemed to be stable and deployable. This means that anything you merge will need to be ready to immediately be live or hidden in some way behind a feature flag.

When work on a new issue or feature is started, the developer should start by creating a new feature branch based on `master`. Since most new work derives from a GitHub Issue, it's recommended to suffix your branch name with the issue. For example, if you're working on a feature to collect a veteran's address as detailed in Issue #25, you might call your issue `address-i25`. It's also helpful to add your initials as a suffix to the branch name, so you can find your branches later.

## Code new functionality

Write the code for the new feature! This is often the fun part. :-)

It's very helpful if you restrict the scope of changes to only the issue/feature that you're working on. For example, you might see some code you can cleanup along the way and decide to change it. However, this increases the scope of your changes and increases risk if your commits/feature need to be rolled back (and the rollback pulls other things with it). It also helps your code reviewer, because they aren't left wondering how a tangential change impacts the feature promised by the pull request.

As you code your changes, commit changes to your feature branch. Commit early. Commit often.

## Write tests for new functionality

The only way to quickly know if your new change breaks the existing functionality of the application is to have a suite of automated tests that execute whenever new stuff is added. When you add new functionality, new tests are required so that future developers know if they have broken your contributions.

There are two kinds of tests you might add:

- Unit: Tests a specific method or very granular piece of the code base.
- End to end: Tests how your code works when clicked through in a real browser.
- Accessibility: Tests that run automated checks to catch some basic accessibility mistakes. Typically these are incorporated into end-to-end tests.

These tests will get automatically executed in the next step, but you should run them locally before moving on.

## Submit pull request

At this point all your code is committed to the feature branch. Additionally, you should sync your feature branch with changes from the `master` branch to incorporate work that has been done concurrently.

Once that is done, you can submit a pull request indicating that your code is ready for review. You can use the GitHub request reviews feature to tag a fellow team member who you feel is qualified to review the code (this prevents the pull request from just sitting). You may also want to tag developers on other teams if the changes cover more than one application.

Depending on the type of work done, you may need a product person to review and / or a developer to review. See [Code Review Norms](https://github.com/department-of-veterans-affairs/vets.gov-team/blob/master/Work%20Practices/Engineering/Code%20Review%20Norms.md) for more information on how we do code reviews.

**Connecting pull requests's**: In the PR, there is a "Connect this pull request with an existing issue" section at the bottom of the issue. Click the "Connect with an issue" button to link the PR to the original issue in Zenhub.

Once your pull request has been submitted, move the ticket and with the connected PR into the Validate column to indicate it's ready for review.

## Run tests and compliance scans

Tests for pre-existing functionality and your new tests will be executed by Jenkins when you push your branch to Github. You can see the results in your PR, which will tell you if you've broken any existing functionality and if your tests execute within a non-local environment. If things fail, the test run will give you context on what broke and what needs to get fixed. All tests, including accessibility and end to end tests are run for each branch.

In addition to tests, other static checks are run:

- Security: The current set of npm dependencies are checked for security vulnerabilities
- Linting: This checks your code for clean style or easy to catch syntactic errors. This helps make the code more maintainable by helping make the code itself idiomatic and consistent looking across modules.

## Test and peer review code

While the PR is open, both code review and manual testing an occur. Depending on the ttype of change, you may need a product or UX person to do manual testing. And we always have developers do code review on PRs

### Testing

This can involve some separate things:

- Making sure the functionality works in the web browsers users are most likely to use
- Run the code on production-like environment. This could be done by spinning up a cloud instance that resembles production, or launching a container that is production like (such as a Docker image, etc.)
- See if there are there any bugs or unexpected nuisances that users might encounter
- Does it meet the requirements?

### Code Review

See our team's [code review norms](https://github.com/department-of-veterans-affairs/vets.gov-team/blob/master/Work%20Practices/Engineering/Code%20Review%20Norms.md) for details on how code review work and what needs to be checked.

## Merge code to master

After all feedback from testing and code review is responded to and the developer and reviewer are in agreement that the code is satisfactory (including re-running automated tests and needing them to pass), it's time to merge the code from its feature branch into the `master` branch.

After all tests and peer review has been completed a member of the team will need to create a branch and manually merge in the proposed changes. They will then need to close the original PR and create a new PR from their branch. This will allow the testing infrastructure to trigger automated testing on the propsed work. Once that testing in complete a second internal team member will be required to approve the work and merge it into the `master` branch

