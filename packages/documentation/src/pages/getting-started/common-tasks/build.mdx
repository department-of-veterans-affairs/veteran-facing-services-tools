# Building VA.gov 

Note: most of the time, it's better to use the `watch` task to build the site locally. This is the most developer-friendly experience.

In order to do a full build of the site, you can run `yarn build`. This will convert the Markdown content in the `vagov-content` repository and data queried from the Drupal API into html pages, and copy those pages, along with other asssets, into `build/localhost`. In addition, it will run Webpack to create bundles for the Javascript that runs on va.gov and will output those files in `build/localhost/generated`.

## Building for other environments

There are four main environments for VA.gov: local, development, staging, and production. Each of those environments has an associated build type: `localhost`, `vagovdev`, `vagovstaging`, `vagovprod`, which you can pass as a flag: 

`yarn build --buildtype=vagovstaging`

The results of the build will go in the a folder underneath `build/` that matches the build type: `build/vagovdev`, `build/vagovstaging`, etc.

For production-like environments (vagovstaging and vagovprod), you will also need to set the `NODE_ENV` environment variable to be `production`, so Webpack builds our Javascript and included dependencies in production mode: 

`NODE_ENV=production yarn build --buildtype=vagovprod`

## Using the built output

Typically, the reason for building the site locally like this is to build it in production mode and check that it is behaving as you'd expect. To do that, you need to run a local http server, which you can do by running 

`npx http-server -p 3001 build/vagovprod`

Be aware that deep-linking to urls that are rendered by React apps on va.gov will not work when you run the site this way, as that relies on some server-side routing that is handled in nginx (or the Webpack dev server when running the `watch` task).
