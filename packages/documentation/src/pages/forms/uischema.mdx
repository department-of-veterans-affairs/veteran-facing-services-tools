
# uiSchema

JSON Schema is limited for describing how a given data type should be rendered as a form input component. That's why the `uiSchema` was introduced by [react-jsonschema-form](https://github.com/mozilla-services/react-jsonschema-form#react-jsonschema-form) as a means of describing how a form page should be rendered from a `schema`. The uiSchema object follows the tree structure of the form field hierarchy, and defines how each property should be rendered.

In the VA Forms Library, `uiSchema` follows the format described in the [react-jsonschema-form documentation](https://react-jsonschema-form.readthedocs.io/en/latest/api-reference/uiSchema/), with some custom additions. 

- [react-jsonschema-form uiSchema properties](#react-jsonschema-form-uischema-properties)
- [Additional uiSchema functionality](#additional-uischema-functionality)

Note that every property within uiSchema can be rendered in one of two ways: `{"ui:options": {[property]: [value]}},` or `{"ui:[property]": value}`. The `schema` and `uiSchema` objects should have a similar structure, with the same fields organized in the same way with these exceptions:

- `uiSchema` doesn't need to contain all the fields found in the `schema` object.
- `uiSchema` doesn't need a `properties` object for sub-fields.

For example, given this schema:

```js
{
  type: 'object',
  properties: {
    field1: {
      type: 'string'
    }
  }
}
```

The matching `uiSchema` would be:

```js
{
  'ui:title': 'My form',
  field1: {
    'ui:title': 'My field'
  }
}
```

For array fields, you must specify an `items` object that contains the fields for each row in the array in the `uiSchema` object:

```js
{
  'ui:title': 'My form',
  toursOfDuty: {
    items: {
      branchName: {
        'ui:title': 'Branch'
      }
    }
  }
}
```

## react-jsonschema-form uiSchema properties

Some commonly used options include:

- [ui:order](https://github.com/mozilla-services/react-jsonschema-form#object-fields-ordering): An array of field names in the order in which they should appear.
- [ui:widget](https://github.com/mozilla-services/react-jsonschema-form#alternative-widgets): The name of an alternative widget to use for the field, for example, a custom widget called `yesNo`.
- [ui:field](https://github.com/mozilla-services/react-jsonschema-form#custom-field-components): The name of a custom field.
- [classNames](https://github.com/mozilla-services/react-jsonschema-form#custom-css-class-names): The class names to put on the component.


### classNames
The `uiSchema` object accepts a `classNames` property for each field of the schema:

```js
const uiSchema = {
  title: {
    classNames: "task-title foo-bar"
  }
};
```

Will result in:

```html
<div class="field field-string task-title foo-bar" >
  <label>
    <span>Title*</span>
    <input value="My task" required="" type="text">
  </label>
</div>
```

### autofocus
If you want to automatically focus on a text input or `textarea` input, set the `ui:autofocus` uiSchema directive to true.

```js
const schema = {type: "string"};
const uiSchema = {
  "ui:widget": "textarea",
  "ui:autofocus": true
}
```

### description
Sometimes it's convenient to change the description of a field. This is the purpose of the `ui:description` uiSchema directive:

```
const schema = {type: "string"};
const uiSchema = {
  "ui:widget": "password",
  "ui:description": "The best password"
};
```

### disabled
The `ui:disabled` uiSchema directive will disable all child widgets from a given field.

**Note:** Marking a field as read-only will render it greyed out, but its text value will be selectable. Disabling it will prevent its value to be selected at all.

### enumDisabled
To disable an option, use the `enumDisabled` property in uiSchema.

```js
const schema = {
  type: "string",
  enum: ["one", "two", "three"],
};

const uiSchema={
  "ui:enumDisabled": ['two'],
}
```

### help
Sometimes it's convenient to add text next to a field to guide the end user filling it. This is the purpose of the `ui:help` uiSchema directive:

```js
const schema = {type: "string"};
const uiSchema = {
  "ui:widget": "password",
  "ui:help": "Hint: Make it strong!"
};
```

Help texts work for any kind of field at any level, and will always be rendered immediately below the field component widgets (after contextualized errors, if any).

### inputType
To change the input type (for example, tel or email) you can specify the inputType in the `ui:options` uiSchema directive.

```js
const schema = {type: "string"};
const uiSchema = {
  "ui:options": {
    inputType: 'tel'
  }
};
```

### label
Field labels are rendered by default. Labels may be omitted by setting the label option to false in the `ui:options` uiSchema directive.

### order
This property allows you to reorder the properties that are shown for a particular object.

### placeholder
You can add placeholder text to an input by using the `ui:placeholder` uiSchema directive. Fields using `enum` can also use `ui:placeholder`. The value will be used as the text for the empty option in the select widget.

### readonly
The `ui:readonly` uiSchema directive will mark all child widgets from a given field as read-only. This is equivalent to setting the `readOnly` property in the schema.

**Note:** Marking a field as read-only will render it greyed out, but its text value will be selectable. Disabling it will prevent its value to be selected at all.

### rootFieldId
By default, this library will generate IDs unique to the form for all rendered widgets. If you plan on using multiple instances of the Form component in a same page, it's wise to declare a root prefix for these, using the `ui:rootFieldId` uiSchema directive.

```js
const uiSchema = {
  "ui:rootFieldId": "myform"
};
```

This will make all widgets have an `id` prefixed with `myform`.

### rows
You can set the initial height of a `textarea` widget by specifying rows option.

```js
const schema = {type: "string"};
const uiSchema = {
  "ui:widget": "textarea",
  "ui:options": {
    rows: 15
  }
};
```

### title
Sometimes it's convenient to change a field's title. This is the purpose of the `ui:title` uiSchema directive.

```js
const schema = {type: "string"};
const uiSchema = {
  "ui:widget": "password",
  "ui:title": "Your password"
};
```

## Additional uiSchema functionality
The VA Forms Library code includes additional `uiSchema` functionality not found in the react-jsonschema-form library.

### ui:title
Used instead of the `title` property in the JSON Schema, it can also be a component, which passes the current form data as a property.
```js
'ui:title': ({ formData }) => <legend>{`A ${formData.thing} title`}</legend>,
```

### ui:description

Used instead of the `description` property in the JSON Schema, this property can be a string or a React component, and is normally used on object fields in the schema to provide description text or HTML before a block of fields.
```js
'ui:description': '' || DescriptionComponent,
```
### ui:field and ui:widget
Customizes the field or widget you are working on.

```js
'ui:field': '' || FieldComponent,
'ui:widget': '' || WidgetComponent,
```

### ui:reviewWidget
This property renders string fields on the review page. It is always used when you specify a custom widget component and it can also be used with regular widgets.

```js
'ui:reviewWidget': WidgetComponent,
```

### ui:reviewField
This property renders a custom review field on the review page and is only used when you specify a widget component. The `children` parameter is a component from the `ui:reviewWidget`, but is only rendered by this custom `reviewField` if the schema for it is not an `object` or `array`. **Note:** You must return a div with a "review-row" class name and include child <dt> and <dd> elements to maintain accessibility standards.

```js
 'ui:reviewField': ({ children, schema, uiSchema }) => (
    <div className="review-row">
      <dt>
        {uiSchema['ui:title']}
        {uiSchema['ui:description]}
      </dt>
      <dd>{children}</dd>
    </div>
  ),
```
 
### ui:required
This `ui:required` property provides a function to make a field conditionally required. The data in the whole form, with no page breaks, is the only parameter. Don't use this property if you already made the field required in the JSON schema. The index argument is provided if you use `ui:required` on data inside an array.

```js
'ui:required': function (formData, index) {
    return true || false;
  },
```

### ui:validations
The `ui:validations` property is an array of validation functions or objects that you can use to add validation that is not possible through JSON Schema. See below for the properties passed to the validation functions and how to use them.

```js
 'ui:validations': [
    /**
     * Note the difference between the three data parameters:
     *
     * @param {any} fieldData The data for the current field being validated
     * @param {object} formData The data for all the fields in every page
     */
    function (errors, fieldData, formData, fieldSchema, errorMessages) {
      errors.addError('My error');
    },
    {
      validator: (errors, fieldData, formData, fieldSchema, errorMessages, options) => {
        errors.addError('My other error');
      },
      options: {}
    }
  ],

```

This property is added to a form field level. It will validate isolated form field data.
```js
{
  validator: (errors, pageData) => {
    const { email, confirmEmail } = pageData;
    if (email !== confirmEmail) {
      errors.confirmEmail.addError('Please ensure your entries match');
    }
  }
}
```


### ui:errorMessages
An object with field-specific error messages, `ui:errorMessages` is structured by error name (from JSON Schema error types). This property is passed to custom validations in `ui:validations` in order to allow configurable error messages in a validator.

```js
ui:errorMessages': {
    'pattern': 'Please provide a value in the right format'
  },
  'ui:options': {

    // An map of enum values to labels that are shown by the select and radio widgets.
    labels: {
      chapter30: 'A readable description (Chapter 30)'
    },
```

### nestedContent
A map of values to a component, text, or [JSX](https://reactjs.org/docs/introducing-jsx.html). If your field is a radio widget, the content here is shown underneath the radio button for that value when it's selected.
```js
    nestedContent: {
      'value': <p>Some text</p>
    },
```

### widgetClassNames
This component is a string of class names that are added to the widget for the current field. `widgetClassNames` is similar to the default `classNames` property, but it puts the class names on the input/select/etc. element itself, rather than a surrounding `div`.

```js
    widgetClassNames: '',
```

### viewField
For array fields, this component is shown when the item in the array is rendered as read-only on a page that is not a review page.

```js
viewField: RowViewComponent,
```

### expandUnder
To show a field only when another field is true, set this option to the property name. It wraps the fields with an `ExpandingGroup` component using the `expandUnder` field as the first question.

```js
expandUnder: '',
```

### expandUnderCondition
To match to a specific value, use the `expandUnderCondition` option to specify the value that the `expandUnder` field's data should equal.

```js
expandUnderCondition: 'someValue',
```

`expandUnderCondition` can also be a function that receives the data from the `expandUnder` field as an argument.

```js
expandUnderCondition: (field) => field === 'someValue' || field === 'someOtherValue',
```

### expandUnderClassNames
When using the expandUnder option, you can set `expandUnderClassNames` on the field specified by `expandUnder` and it will add classes to the `div` that wraps all of the fields when they're expanded. 

```js
expandUnderClassNames: '',
```

### hideOnReview
Hides the specified field on the review page.

```js
hideOnReview: true || false,
```

### hideOnReviewIfFalse
Hides the specified field on the review page when the field value is `false`.
```js
hideOnReviewIfFalse: true || false,
```

### hideEmptyValueInReview
Hide review row entry if the form value is an empty string, null or undefined. This option is ignored if there is a custom `'ui:reviewField'` defined

```js
hideEmptyValueInReview: true || false,
```

### hideLabelText
Hides label added before the widget.

```js
hideLabelText: true || false,
```

### showFieldLabel 
Use label or legend (inside fieldset).

```js
showFieldLabel: 'label', // vs anything other than 'label'
```

### hideIf
A function that conditionally hides fields in the form. `hideIf` provides the `index` argument when you use `ui:required` on data inside an array.

```js
    hideIf: function (formData, index) {
      return true || false;
    },
```

### updateSchema
A function that conditionally replaces the current field's schema. `updateSchema` provides the `index` argument when you use `ui:required` on data inside an array.

```js
updateSchema: function (formData, schema, uiSchema, index, pathToCurrentData) 
```

This function returns an object with the properties you want to update. Instead of replacing the existing schema, it updates the individual properties.

```js
updateSchema: function (formData, schema, uiSchema, index, pathToCurrentData) {
      return {
        type: 'string'
      };
    },
```

In the following example, the available options in a dropdown menu are changed. The function only updates the `enum` and the `enumNames` keys — it will not replace or delete the other keys.

```js
const optionsGroup1 = { 
          enum: ['option1', 'option2'],
          enumNames: ['Option 1', 'Option 2']
};
const optionsGroup2 = { 
          enum: ['option1', 'option3'],
          enumNames: ['Option 1', 'Option 3']
};

// schema
{
  'ui:options': {
    updateSchema: (form, pageSchema) {
      if (form.myField === 'otherOption') {
        return optionsGroup1;
      } else {
        return optionsGroup2;
      }
    }
  }
}
```


### keepInPageOnReview
By default, array fields that are displayed on a single page in a form, such as information for multiple dependents, are displayed in a separate section on the review page. To keep the information in a single section on a review page, set this property to `true`.

```js
keepInPageOnReview: true
```
