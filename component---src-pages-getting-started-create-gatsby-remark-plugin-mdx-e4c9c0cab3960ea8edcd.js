(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{"3dLD":function(e,a,t){"use strict";t.d(a,"a",(function(){return m}));var r=t("q1tI"),n=t.n(r),i=t("FRpb");function s(e){var a=e.sourceUrl;return a?n.a.createElement("div",null,n.a.createElement("i",{class:"fa fa-edit","aria-hidden":"true"})," ",n.a.createElement("a",{href:a},"Edit this page on GitHub")):null}var l=t("8FPV");function m(e){var a=e.children,t=e.location,r=e.pageContext;return n.a.createElement(l.a,{location:t},n.a.createElement("div",{className:"vads-l-row site-l-wrapper"},n.a.createElement(i.a,{location:t}),n.a.createElement("div",{id:"main-content",className:"vads-l-col--8 site-c-content__content docSearch-content"},a,n.a.createElement(s,{sourceUrl:r.sourceUrl}))))}},FRpb:function(e,a,t){"use strict";t.d(a,"a",(function(){return c}));var r=t("q1tI"),n=t.n(r),i=t("Wbzz");function s(e){var a=e.item;return a.href?n.a.createElement("li",{key:a.name},n.a.createElement(i.Link,{to:a.href},a.name)):n.a.createElement("li",{key:a.name},a.name," (future)")}function l(e){var a=e.items,t=e.isSublist,r=void 0!==t&&t;return a.length?n.a.createElement("ul",{className:"site-c-sidenav-list"},a.map((function(e){return e.items?n.a.createElement("li",{key:e.name},r&&n.a.createElement(s,{item:e}),!r&&n.a.createElement("h2",{className:"heading-level-4"},e.name),n.a.createElement(l,{isSublist:!0,items:e.items})):n.a.createElement(s,{item:e,key:e.name})}))):null}var m=t("MEl4"),o=t.n(m);function c(e){var a=e.location,t=o.a.sections.find((function(e){return a.pathname.includes(e.href)}));return t?n.a.createElement("div",{className:"vads-l-col--4 site-c-content__nav"},n.a.createElement("div",{className:"site-c-sidenav"},n.a.createElement(l,{items:t.items}))):null}},rC7D:function(e,a,t){"use strict";t.r(a),t.d(a,"_frontmatter",(function(){return l})),t.d(a,"default",(function(){return c}));var r=t("zLVn"),n=(t("q1tI"),t("7ljp")),i=t("3dLD"),s=["components"],l={},m={_frontmatter:l},o=i.a;function c(e){var a=e.components,t=Object(r.a)(e,s);return Object(n.b)(o,Object.assign({},m,t,{components:a,mdxType:"MDXLayout"}),Object(n.b)("h2",{id:"create-a-gatsby-remark-plugin"},"Create a Gatsby Remark plugin"),Object(n.b)("p",null,"Gatsby uses a plugin called ",Object(n.b)("a",{parentName:"p",href:"https://www.gatsbyjs.org/packages/gatsby-transformer-remark/"},"gatsby-transformer-remark"),"\nto convert markdown to html. Our MDX plugin ",Object(n.b)("a",{parentName:"p",href:"https://www.gatsbyjs.org/packages/gatsby-mdx/"},"gatsby-mdx")," uses this plugin\nto convert markdown to html. We needed to create a way to add graphs to our MDX files so we tried to implement another plugin that adds the ",Object(n.b)("a",{parentName:"p",href:"https://mermaidjs.github.io/"},"mermaid")," feature to markdown. The problem was that it had conflicts with MDX files. This article will detail how we added our own plugin locally to the ",Object(n.b)("inlineCode",{parentName:"p"},"gatsby-transformer-remark")," plugin to solve this issue."),Object(n.b)("h3",{id:"what-are-we-doing"},"What are we doing"),Object(n.b)("p",null,"We needed a way to generate graphs using markdown like the code below. Normally this is done using the mermaid library. That is what we are going to use, but we need it to work with MDX files. Below is an example of what we are trying to do."),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"Markdown")),Object(n.b)("pre",null,Object(n.b)("code",{parentName:"pre"},"```mermaid\ngraph LR\n    A[Square Rect] -- Link text --\x3e B((Circle))\n    A --\x3e C(Round Rect)\n    B --\x3e D{Rhombus}\n    C --\x3e D\n```\n")),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"HTML Output")),Object(n.b)("div",{className:"mermaid","data-processed":"true"},Object(n.b)("svg",{parentName:"div",id:"mermaid-1670339210182",width:"100%",xmlns:"http://www.w3.org/2000/svg",xmlnsXLink:"http://www.w3.org/1999/xlink",height:"164.890625",style:{maxWidth:"502.8671875px"},viewBox:"0 0 502.8671875 164.890625"},Object(n.b)("style",{parentName:"svg"},'#mermaid-1670339210182 {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-1670339210182 .error-icon{fill:#552222;}#mermaid-1670339210182 .error-text{fill:#552222;stroke:#552222;}#mermaid-1670339210182 .edge-thickness-normal{stroke-width:2px;}#mermaid-1670339210182 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1670339210182 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1670339210182 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1670339210182 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1670339210182 .marker{fill:#333333;stroke:#333333;}#mermaid-1670339210182 .marker.cross{stroke:#333333;}#mermaid-1670339210182 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-1670339210182 .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-1670339210182 .cluster-label text{fill:#333;}#mermaid-1670339210182 .cluster-label span{color:#333;}#mermaid-1670339210182 .label text,#mermaid-1670339210182 span{fill:#333;color:#333;}#mermaid-1670339210182 .node rect,#mermaid-1670339210182 .node circle,#mermaid-1670339210182 .node ellipse,#mermaid-1670339210182 .node polygon,#mermaid-1670339210182 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-1670339210182 .node .label{text-align:center;}#mermaid-1670339210182 .node.clickable{cursor:pointer;}#mermaid-1670339210182 .arrowheadPath{fill:#333333;}#mermaid-1670339210182 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-1670339210182 .flowchart-link{stroke:#333333;fill:none;}#mermaid-1670339210182 .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-1670339210182 .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-1670339210182 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-1670339210182 .cluster text{fill:#333;}#mermaid-1670339210182 .cluster span{color:#333;}#mermaid-1670339210182 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-1670339210182 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}'),Object(n.b)("g",{parentName:"svg"},Object(n.b)("g",{parentName:"g",className:"output"},Object(n.b)("g",{parentName:"g",className:"clusters"}),Object(n.b)("g",{parentName:"g",className:"edgePaths"},Object(n.b)("g",{parentName:"g",className:"edgePath LS-A LE-B",id:"L-A-B",style:{opacity:"1"}},Object(n.b)("path",{parentName:"g",className:"path",d:"M104.22128358472779,69.16796875L115.47346548727315,64.04752604166667C126.72564738981852,58.927083333333336,149.23001119490925,48.686197916666664,173.24912018078794,43.565755208333336C197.26822916666666,38.4453125,222.80208333333334,38.4453125,235.56901041666666,38.4453125L248.3359375,38.4453125",markerEnd:"url(#arrowhead15)",style:{fill:"none"}}),Object(n.b)("defs",{parentName:"g"},Object(n.b)("marker",{parentName:"defs",id:"arrowhead15",viewBox:"0 0 10 10",refX:"9",refY:"5",markerUnits:"strokeWidth",markerWidth:"8",markerHeight:"6",orient:"auto"},Object(n.b)("path",{parentName:"marker",d:"M 0 0 L 10 5 L 0 10 z",className:"arrowheadPath",style:{strokeWidth:"1",strokeDasharray:"1, 0"}})))),Object(n.b)("g",{parentName:"g",className:"edgePath LS-A LE-C",id:"L-A-C",style:{opacity:"1"}},Object(n.b)("path",{parentName:"g",className:"path",d:"M104.22128358472779,107.16796875L115.47346548727315,112.28841145833333C126.72564738981852,117.40885416666667,149.23001119490925,127.64973958333333,169.61500559745463,132.77018229166666C190,137.890625,208.265625,137.890625,217.3984375,137.890625L226.53125,137.890625",markerEnd:"url(#arrowhead16)",style:{fill:"none"}}),Object(n.b)("defs",{parentName:"g"},Object(n.b)("marker",{parentName:"defs",id:"arrowhead16",viewBox:"0 0 10 10",refX:"9",refY:"5",markerUnits:"strokeWidth",markerWidth:"8",markerHeight:"6",orient:"auto"},Object(n.b)("path",{parentName:"marker",d:"M 0 0 L 10 5 L 0 10 z",className:"arrowheadPath",style:{strokeWidth:"1",strokeDasharray:"1, 0"}})))),Object(n.b)("g",{parentName:"g",className:"edgePath LS-B LE-D",id:"L-B-D",style:{opacity:"1"}},Object(n.b)("path",{parentName:"g",className:"path",d:"M309.2265625,38.4453125L317.02734375,38.4453125C324.828125,38.4453125,340.4296875,38.4453125,356.0635984444548,43.23262551387859C371.6975093889095,48.019938527757176,387.36376877781896,57.594564555514346,395.19689847227374,62.381877569392934L403.03002816672847,67.16919058327152",markerEnd:"url(#arrowhead17)",style:{fill:"none"}}),Object(n.b)("defs",{parentName:"g"},Object(n.b)("marker",{parentName:"defs",id:"arrowhead17",viewBox:"0 0 10 10",refX:"9",refY:"5",markerUnits:"strokeWidth",markerWidth:"8",markerHeight:"6",orient:"auto"},Object(n.b)("path",{parentName:"marker",d:"M 0 0 L 10 5 L 0 10 z",className:"arrowheadPath",style:{strokeWidth:"1",strokeDasharray:"1, 0"}})))),Object(n.b)("g",{parentName:"g",className:"edgePath LS-C LE-D",id:"L-C-D",style:{opacity:"1"}},Object(n.b)("path",{parentName:"g",className:"path",d:"M331.03125,137.890625L335.1979166666667,137.890625C339.3645833333333,137.890625,347.6979166666667,137.890625,359.6977130277881,133.26997865278807C371.6975093889095,128.64933230557617,387.36376877781896,119.40803961115232,395.19689847227374,114.78739326394039L403.03002816672847,110.16674691672848",markerEnd:"url(#arrowhead18)",style:{fill:"none"}}),Object(n.b)("defs",{parentName:"g"},Object(n.b)("marker",{parentName:"defs",id:"arrowhead18",viewBox:"0 0 10 10",refX:"9",refY:"5",markerUnits:"strokeWidth",markerWidth:"8",markerHeight:"6",orient:"auto"},Object(n.b)("path",{parentName:"marker",d:"M 0 0 L 10 5 L 0 10 z",className:"arrowheadPath",style:{strokeWidth:"1",strokeDasharray:"1, 0"}}))))),Object(n.b)("g",{parentName:"g",className:"edgeLabels"},Object(n.b)("g",{parentName:"g",className:"edgeLabel",transform:"translate(171.734375,38.4453125)",style:{opacity:"1"}},Object(n.b)("g",{parentName:"g",transform:"translate(-29.796875,-9)",className:"label"},Object(n.b)("rect",{parentName:"g",rx:"0",ry:"0",width:"59.59375",height:"18"}),Object(n.b)("foreignObject",{parentName:"g",width:"59.59375",height:"18"},Object(n.b)("div",{parentName:"foreignObject",xmlns:"http://www.w3.org/1999/xhtml",style:{display:"inline-block",whiteSpace:"nowrap"}},Object(n.b)("span",{parentName:"div",id:"L-L-A-B",className:"edgeLabel L-LS-A' L-LE-B"},"Link text"))))),Object(n.b)("g",{parentName:"g",className:"edgeLabel",transform:"",style:{opacity:"1"}},Object(n.b)("g",{parentName:"g",transform:"translate(0,0)",className:"label"},Object(n.b)("rect",{parentName:"g",rx:"0",ry:"0",width:"0",height:"0"}),Object(n.b)("foreignObject",{parentName:"g",width:"0",height:"0"},Object(n.b)("div",{parentName:"foreignObject",xmlns:"http://www.w3.org/1999/xhtml",style:{display:"inline-block",whiteSpace:"nowrap"}},Object(n.b)("span",{parentName:"div",id:"L-L-A-C",className:"edgeLabel L-LS-A' L-LE-C"}))))),Object(n.b)("g",{parentName:"g",className:"edgeLabel",transform:"",style:{opacity:"1"}},Object(n.b)("g",{parentName:"g",transform:"translate(0,0)",className:"label"},Object(n.b)("rect",{parentName:"g",rx:"0",ry:"0",width:"0",height:"0"}),Object(n.b)("foreignObject",{parentName:"g",width:"0",height:"0"},Object(n.b)("div",{parentName:"foreignObject",xmlns:"http://www.w3.org/1999/xhtml",style:{display:"inline-block",whiteSpace:"nowrap"}},Object(n.b)("span",{parentName:"div",id:"L-L-B-D",className:"edgeLabel L-LS-B' L-LE-D"}))))),Object(n.b)("g",{parentName:"g",className:"edgeLabel",transform:"",style:{opacity:"1"}},Object(n.b)("g",{parentName:"g",transform:"translate(0,0)",className:"label"},Object(n.b)("rect",{parentName:"g",rx:"0",ry:"0",width:"0",height:"0"}),Object(n.b)("foreignObject",{parentName:"g",width:"0",height:"0"},Object(n.b)("div",{parentName:"foreignObject",xmlns:"http://www.w3.org/1999/xhtml",style:{display:"inline-block",whiteSpace:"nowrap"}},Object(n.b)("span",{parentName:"div",id:"L-L-C-D",className:"edgeLabel L-LS-C' L-LE-D"})))))),Object(n.b)("g",{parentName:"g",className:"nodes"},Object(n.b)("g",{parentName:"g",className:"node default",id:"flowchart-A-8",transform:"translate(62.46875,88.16796875)",style:{opacity:"1"}},Object(n.b)("rect",{parentName:"g",rx:"0",ry:"0",x:"-54.46875",y:"-19",width:"108.9375",height:"38",className:"label-container"}),Object(n.b)("g",{parentName:"g",className:"label",transform:"translate(0,0)"},Object(n.b)("g",{parentName:"g",transform:"translate(-44.46875,-9)"},Object(n.b)("foreignObject",{parentName:"g",width:"88.9375",height:"18"},Object(n.b)("div",{parentName:"foreignObject",xmlns:"http://www.w3.org/1999/xhtml",style:{display:"inline-block",whiteSpace:"nowrap"}},"Square Rect"))))),Object(n.b)("g",{parentName:"g",className:"node default",id:"flowchart-B-9",transform:"translate(278.78125,38.4453125)",style:{opacity:"1"}},Object(n.b)("circle",{parentName:"g",x:"-30.4453125",y:"-19",r:"30.4453125",className:"label-container"}),Object(n.b)("g",{parentName:"g",className:"label",transform:"translate(0,0)"},Object(n.b)("g",{parentName:"g",transform:"translate(-20.4453125,-9)"},Object(n.b)("foreignObject",{parentName:"g",width:"40.890625",height:"18"},Object(n.b)("div",{parentName:"foreignObject",xmlns:"http://www.w3.org/1999/xhtml",style:{display:"inline-block",whiteSpace:"nowrap"}},"Circle"))))),Object(n.b)("g",{parentName:"g",className:"node default",id:"flowchart-C-11",transform:"translate(278.78125,137.890625)",style:{opacity:"1"}},Object(n.b)("rect",{parentName:"g",rx:"5",ry:"5",x:"-52.25",y:"-19",width:"104.5",height:"38",className:"label-container"}),Object(n.b)("g",{parentName:"g",className:"label",transform:"translate(0,0)"},Object(n.b)("g",{parentName:"g",transform:"translate(-42.25,-9)"},Object(n.b)("foreignObject",{parentName:"g",width:"84.5",height:"18"},Object(n.b)("div",{parentName:"foreignObject",xmlns:"http://www.w3.org/1999/xhtml",style:{display:"inline-block",whiteSpace:"nowrap"}},"Round Rect"))))),Object(n.b)("g",{parentName:"g",className:"node default",id:"flowchart-D-13",transform:"translate(437.94921875,88.16796875)",style:{opacity:"1"}},Object(n.b)("polygon",{parentName:"g",points:"56.91796875,0 113.8359375,-56.91796875 56.91796875,-113.8359375 0,-56.91796875",transform:"translate(-56.91796875,56.91796875)",className:"label-container"}),Object(n.b)("g",{parentName:"g",className:"label",transform:"translate(0,0)"},Object(n.b)("g",{parentName:"g",transform:"translate(-34.2421875,-9)"},Object(n.b)("foreignObject",{parentName:"g",width:"68.484375",height:"18"},Object(n.b)("div",{parentName:"foreignObject",xmlns:"http://www.w3.org/1999/xhtml",style:{display:"inline-block",whiteSpace:"nowrap"}},"Rhombus")))))))))),Object(n.b)("p",null,"Remark uses a plugin system that enables you to do some customization when the markdown gets converted into html through Remark. That is what we are going to use to convert our markdown into a graph."),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("p",{parentName:"li"},"First we need to create a plugin that we can add to the ",Object(n.b)("inlineCode",{parentName:"p"},"gatsby-transformer-remark")," plugin."),Object(n.b)("p",{parentName:"li"},"Below is the code we are using to generate the html to convert our code into graphs. When adding this to the plugin, this code will run during the transformation phase. In this code we are taking the ",Object(n.b)("inlineCode",{parentName:"p"},"mardownAST")," and finding mermaid specific code on the page. Then we change the code to html."),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",{parentName:"pre",className:"language-javascript"},"// plugins/remark/gatsby-remark-mdx-mermaid/index.js\n\nconst visit = require('unist-util-visit');\n\nmodule.exports = ({ markdownAST }, { language = 'mermaid', theme = 'default' } = {}) => {\n  visit(markdownAST, 'code', node => {\n    let lang = (node.lang || '').toLowerCase()\n    if (lang === language) {\n      node.type = 'html'\n      node.value = '<div class=\"mermaid\">{' + '`'+ node.value + '`'+ '}</div>'\n    }\n  })\n}\n")),Object(n.b)("p",{parentName:"li"},"This markdown code:"),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",{parentName:"pre"},"```mermaid\ngraph LR\n    A[Square Rect] -- Link text --\x3e B((Circle))\n    A --\x3e C(Round Rect)\n    B --\x3e D{Rhombus}\n    C --\x3e D\n```\n")),Object(n.b)("p",{parentName:"li"},"Will generate:"),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",{parentName:"pre"},'<div class="mermaid">\n`\ngraph LR\n    A[Square Rect] -- Link text --\x3e B((Circle))\n    A --\x3e C(Round Rect)\n    B --\x3e D{Rhombus}\n    C --\x3e D\n`\n</div>\n')),Object(n.b)("p",{parentName:"li"},"Notice the back ticks inside the innerText. This was done because of MDX. MDX was interpreting the ",Object(n.b)("inlineCode",{parentName:"p"},"{}")," as JSX templating which causes an error. So we need to wrap the code in back ticks to make it work with MDX files.")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("p",{parentName:"li"},"Add it to our MDX remarks plugin."),Object(n.b)("p",{parentName:"li"},"In our ",Object(n.b)("inlineCode",{parentName:"p"},"gatsby-config.js")," file we need to add our plugin to the ",Object(n.b)("inlineCode",{parentName:"p"},"gatsby-mdx plugin"),". Because this is a Remark plugin we need to add it to ",Object(n.b)("inlineCode",{parentName:"p"},"gatsbyRemarkPlugins"),". This is where you can add ",Object(n.b)("inlineCode",{parentName:"p"},"gatsby-transformer-remark")," specific plugins."),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",{parentName:"pre",className:"language-javascript"},"// gatsby-configs.js\n\n{\n  resolve: `gatsby-mdx`,\n  options: {\n    extensions: ['.mdx'],\n    mediaTypes: ['text/x-markdown'],\n    defaultLayouts: {\n      default: require.resolve(\"./src/layouts/layout.js\"),\n    },\n    gatsbyRemarkPlugins: [\n      {\n        resolve: path.resolve(__dirname, './plugins/remark/gatsby-remark-mdx-mermaid'),\n        options: {\n          language: 'mermaid',\n          theme: 'default'\n        }\n      }\n    ],\n  }\n}\n"))),Object(n.b)("li",{parentName:"ul"},Object(n.b)("p",{parentName:"li"},"Add the mermaid library so it can convert our code into SVG graphs"),Object(n.b)("p",{parentName:"li"},"Because mermaid is a client side library we need to include it when the build is rendered on the client-side.\nTo do this we add some code to our Layout Component that will inject the script in the ",Object(n.b)("strong",{parentName:"p"},"componentDidMount")," lifecycle hook."),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",{parentName:"pre",className:"language-javascript"},"class Layout extends React.Component {\n  componentDidMount() {\n    window.mermaid_config = { theme: 'default', startOnLoad: true }\n    const s = document.createElement('script');\n    s.setAttribute('src', 'https://unpkg.com/mermaid@7.1.0/dist/mermaid.min.js');\n    document.head.appendChild(s);\n\n    if (window.mermaid) {\n      window.mermaid.init(undefined, document.getElementsByClassName('mermaid'));\n    }\n  }\n  .....\n}\n"))),Object(n.b)("li",{parentName:"ul"},Object(n.b)("p",{parentName:"li"},"Once all this all setup we are good to go."))))}c.isMDXComponent=!0},zLVn:function(e,a,t){"use strict";function r(e,a){if(null==e)return{};var t,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],a.indexOf(t)>=0||(n[t]=e[t]);return n}t.d(a,"a",(function(){return r}))}}]);
//# sourceMappingURL=component---src-pages-getting-started-create-gatsby-remark-plugin-mdx-e4c9c0cab3960ea8edcd.js.map